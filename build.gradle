buildscript {
   repositories { 
      mavenLocal() 
      jcenter()
      mavenCentral()
   }
   dependencies {
      classpath("org.springframework.boot:spring-boot-gradle-plugin:2.2.2.RELEASE")
      //classpath 'org.kordamp.gradle:stats-gradle-plugin:0.2.2'
   }
}

plugins { 
   id 'io.franzbecker.gradle-lombok' version '1.14'
   id "io.spring.dependency-management" version "1.0.8.RELEASE" 
   id "com.github.kt3k.coveralls" version "2.8.1" 
   id "org.owasp.dependencycheck" version "3.1.2"
   id "org.asciidoctor.convert" version "1.5.3"
}

apply plugin: 'java'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'
//apply plugin: 'org.kordamp.gradle.stats'

jar {
   baseName = 'auth-service'
   version =  '0.1'
}

repositories {
   mavenLocal() 
   jcenter()
   mavenCentral()
   maven { url 'http://oss.jfrog.org/artifactory/oss-snapshot-local/' }
}

sourceCompatibility = 1.8
targetCompatibility = 1.8

configurations {
   all*.exclude module : 'spring-boot-starter-logging'
}

if (project.hasProperty('travis')) {
   println 'Using travis profile for building ' + project.getName()
   apply from: 'gradle/git_checkout.gradle'
   apply from: 'gradle/profile-travis.gradle'
} else if (project.hasProperty('release') || project.hasProperty('clean-release')) {
   println 'Using release profile for building ' + project.getName()
   apply from: 'gradle/git_checkout.gradle'
   apply from: 'gradle/profile-release.gradle'   
}

dependencies {
   implementation("org.springframework.boot:spring-boot-starter-data-rest")
   implementation("org.springframework:spring-context-support")
   implementation("org.springframework.boot:spring-boot-starter-amqp")

   implementation("edu.kit.datamanager:service-base:0.1")

   implementation("com.monitorjbl:spring-json-view:0.16")
   implementation("org.postgresql:postgresql:42.2.1")

   testImplementation("com.h2database:h2:1.4.194")
   testImplementation("org.springframework.restdocs:spring-restdocs-mockmvc")
   testImplementation("org.springframework.boot:spring-boot-starter-test")   
   testImplementation("org.springframework:spring-test")
   testImplementation 'org.springframework.security:spring-security-test'

   asciidoctor('org.springframework.restdocs:spring-restdocs-asciidoctor:2.0.2.RELEASE')
}

bootJar {
   manifest {
      attributes 'Main-Class': 'org.springframework.boot.loader.PropertiesLauncher'
   }
   dependsOn asciidoctor
   from ("${asciidoctor.outputDir}/html5") {
      into 'static/docs'
   }
   launchScript()
}

test {
   testLogging {
      outputs.upToDateWhen {false}
      showStandardStreams = true
   }
}

lombok {
   version = '1.18.10'
   sha256 = ""
}
